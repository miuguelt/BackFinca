<!-- Plantilla HTML para renderizar la gu√≠a Markdown del frontend con estilos y navegaci√≥n -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ title or 'Gu√≠a Frontend' }}</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    html { scroll-behavior: smooth; }
    :root {
      --bg: #0b1324;
      --panel: #0f1a32;
      --text: #e6edf3;
      --muted: #9fb3c8;
      --primary: #3b82f6;
      --primary-600: #2563eb;
      --border: #1e2a44;
      --code: #0a0f1e;
      --code-border: #1a2440;
      --success: #10b981;
      --warning: #f59e0b;
    }
    * { box-sizing: border-box; }
    body { margin: 0; font-family: 'Inter', system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, 'Apple Color Emoji', 'Segoe UI Emoji'; background: var(--bg); color: var(--text); }
    a { color: var(--primary); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .navbar { position: sticky; top: 0; z-index: 20; display: flex; gap: 12px; align-items: center; justify-content: space-between; padding: 12px 20px; background: rgba(11,19,36,0.75); backdrop-filter: blur(8px); border-bottom: 1px solid var(--border); }
    .brand { display: flex; align-items: center; gap: 10px; font-weight: 700; letter-spacing: 0.2px; }
    .brand .logo { width: 28px; height: 28px; border-radius: 6px; background: linear-gradient(135deg, #22d3ee, #6366f1); box-shadow: 0 6px 16px rgba(34,211,238,0.25); }
    .nav-actions { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 12px; border-radius: 8px; background: var(--panel); color: var(--text); border: 1px solid var(--border); font-weight: 600; }
    .btn.primary { background: linear-gradient(180deg, var(--primary), var(--primary-600)); border-color: transparent; box-shadow: 0 10px 22px rgba(59,130,246,0.25); }
    .btn[aria-disabled="true"] { opacity: 0.5; pointer-events: none; }
    .btn .emoji { font-size: 16px; }
    .container { max-width: 1100px; margin: 0 auto; padding: 24px; }
    .hero { margin: 16px 0 20px; padding: 18px 18px; background: linear-gradient(180deg, rgba(63,81,181,0.18), rgba(63,81,181,0.06)); border: 1px solid var(--border); border-radius: 14px; }
    .hero h1 { margin: 0 0 6px; font-size: 28px; }
    .hero p { margin: 0; color: var(--muted); }
    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 18px; }
    .md { line-height: 1.62; }
    .md h2, .md h3 { margin-top: 1.4em; }
    /* Offset de scroll para que los t√≠tulos no queden ocultos bajo la navbar */
    .md h1, .md h2, .md h3, .md h4 { scroll-margin-top: 84px; }
    .md code { background: var(--code); border: 1px solid var(--code-border); padding: 0 6px; border-radius: 6px; }
    pre { background: var(--code); border: 1px solid var(--code-border); border-radius: 10px; padding: 14px; overflow: auto; }
    pre code { background: transparent; border: none; }
    pre.codeblock { position: relative; }
    .copy-btn { position: absolute; top: 8px; right: 8px; background: #111827; color: #e5e7eb; border: 1px solid #374151; border-radius: 6px; padding: 4px 8px; font-size: 12px; cursor: pointer; }
    .copy-btn:hover { background: #0b1220; }
    .footer { margin-top: 24px; padding: 16px; color: var(--muted); text-align: center; }

    .utility { display: flex; gap: 16px; align-items: center; margin: 0 0 16px; }
    .search { flex: 1; }
    .search input { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid var(--border); background: var(--panel); color: var(--text); }
    .toc { min-width: 260px; max-width: 320px; background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 12px; }
    .toc h3 { margin: 0 0 8px; font-size: 14px; color: var(--muted); }
    .toc ul { margin: 0; padding-left: 18px; }
    .toc li { margin: 4px 0; }
    .content-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
    @media (min-width: 1024px) { .content-grid { grid-template-columns: 1fr 300px; } }
    mark { background: #f59e0b44; color: inherit; padding: 0 2px; border-radius: 3px; }
  </style>
  <!-- Markdown-it + highlight.js (client-side) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css" integrity="sha512-rO+olRTkcf304DQBxSWxln8JXCzTHlKnIdnMUwYvQa9/Jd4cQaNkItIUj6Z4nvW1dqK0SKXLbn9h4KwZTNtAyw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/markdown-it/13.0.1/markdown-it.min.js" integrity="sha512-SYfDUYPg5xspsG6OOpXU366G8SZsdHOhqk/icdrYJ2E/WKZxPxze7d2HD3AyXpT7U22PZ5y74xRpqZ6A2bJ+kQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js" integrity="sha512-D9gUyxqja7hBtkWpPWGt9wfbfaMGVt9gnyCvYa+jojwwPHLCzUm5i8rpk7vD7wNee9bA35eYIjobYPaQuKS1MQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>
<body>
  <div class="navbar">
    <div class="brand"><div class="logo"></div> Gu√≠a Frontend</div>
    <div class="nav-actions">
      <a class="btn" href="#quickstart" title="Ir a Gu√≠a r√°pida">‚ö° Gu√≠a r√°pida</a>
      <a id="link-modelos" class="btn" href="#" title="Ir a Modelos">üß± Modelos</a>
      <a id="link-filtros" class="btn" href="#" title="Ir a Filtros avanzados">üîç Filtros</a>
      <a class="btn" href="/api/v1/docs/schema" target="_blank" rel="noopener" title="Ver esquema JSON">üß© Esquema</a>
      <a class="btn" href="/api/v1/docs/examples" target="_blank" rel="noopener" title="Ver ejemplos JSON">üß™ Ejemplos</a>
      <a class="btn" href="/api/v1/docs/" title="Volver a la API">üß≠ API Docs</a>
      <a class="btn primary" href="/api/v1/docs/guia-frontend" title="Ver Markdown crudo">üìÑ Markdown</a>
    </div>
  </div>
  <div class="container">
    <div class="hero">
      <h1>Gu√≠a de Uso del Frontend</h1>
      <p>Ejemplos pr√°cticos y recomendaciones para consumir esta API desde tu SPA.</p>
    </div>
    <div id="quickstart" class="panel" style="margin-bottom:16px;">
      <h2 style="margin-top:0;">‚ö° Gu√≠a r√°pida</h2>
      <ul style="margin:8px 0 0 18px;">
        <li>Consulta el <a href="/api/v1/docs/schema" target="_blank" rel="noopener">esquema</a> para ver recursos y modelos disponibles.</li>
        <li>Abre los <a href="/api/v1/docs/examples" target="_blank" rel="noopener">ejemplos</a> y copia una request de inicio.</li>
        <li>Prueba las llamadas en <a href="/api/v1/docs/" target="_blank" rel="noopener">Swagger UI</a> y luego int√©gralas en tu frontend.</li>
      </ul>
    </div>

    <div class="utility">
      <div class="search" title="Buscar dentro de la gu√≠a">
        <input id="search" placeholder="Buscar en la gu√≠a (m√≠n. 2 letras)‚Ä¶" />
      </div>
      <aside class="toc">
        <h3>√çndice</h3>
        <nav id="toc"></nav>
      </aside>
    </div>

    <div class="content-grid">
      <div class="panel md" id="md-root">Cargando gu√≠a‚Ä¶</div>
      <div></div>
    </div>

    <div class="footer">Finca Villa Luz ‚Ä¢ v{{ config.get('APP_VERSION', '1.0.0') }}</div>
  </div>
  <script>
    const md = window.markdownit({
      html: false,
      linkify: true,
      breaks: true,
      highlight: function (str, lang) {
        try { return window.hljs.highlight(str, {language: lang}).value; } catch (e) {}
        return '';
      }
    });

    function slugify(text) {
      return text
        .toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '') // quitar acentos
        .replace(/[^a-z0-9\s-]/g, '')
        .trim()
        .replace(/\s+/g, '-')
        .replace(/-+/g, '-');
    }

    function buildTOC() {
      const headings = Array.from(document.querySelectorAll('#md-root h2, #md-root h3'));
      const items = [];
      headings.forEach(h => {
        if (!h.id) h.id = slugify(h.textContent);
        items.push({ level: h.tagName.toLowerCase(), text: h.textContent, id: h.id });
      });
      // construir HTML
      let html = '<ul>';
      items.forEach(it => {
        const indent = it.level === 'h3' ? ' style="margin-left:14px"' : '';
        html += `<li${indent}><a href="#${it.id}">${it.text}</a></li>`;
      });
      html += '</ul>';
      document.getElementById('toc').innerHTML = html;

      // Enlaces contextuales en navbar
      const modelos = items.find(i => i.id.includes('modelo') || i.text.toLowerCase().includes('modelo'));
      const filtros = items.find(i => i.id.includes('filtro') || i.text.toLowerCase().includes('filtro'));
      const linkModelos = document.getElementById('link-modelos');
      const linkFiltros = document.getElementById('link-filtros');
      if (modelos) { linkModelos.href = `#${modelos.id}`; linkModelos.removeAttribute('aria-disabled'); }
      else { linkModelos.href = '#'; linkModelos.setAttribute('aria-disabled', 'true'); }
      if (filtros) { linkFiltros.href = `#${filtros.id}`; linkFiltros.removeAttribute('aria-disabled'); }
      else { linkFiltros.href = '#'; linkFiltros.setAttribute('aria-disabled', 'true'); }
    }

    function clearHighlights(root) {
      root.querySelectorAll('mark').forEach(m => {
        const parent = m.parentNode;
        parent.replaceChild(document.createTextNode(m.textContent), m);
        parent.normalize();
      });
    }

    function highlightQuery(query) {
      const root = document.getElementById('md-root');
      clearHighlights(root);
      if (!query || query.length < 2) return;
      // resaltar solo en p√°rrafos y listas
      const nodes = root.querySelectorAll('p, li');
      const q = query.toLowerCase();
      nodes.forEach(node => {
        node.childNodes.forEach(child => {
          if (child.nodeType === 3) {
            const text = child.textContent;
            const idx = text.toLowerCase().indexOf(q);
            if (idx >= 0) {
              const before = document.createTextNode(text.slice(0, idx));
              const mark = document.createElement('mark');
              mark.textContent = text.slice(idx, idx + q.length);
              const after = document.createTextNode(text.slice(idx + q.length));
              const frag = document.createDocumentFragment();
              frag.appendChild(before); frag.appendChild(mark); frag.appendChild(after);
              node.replaceChild(frag, child);
            }
          }
        });
      });
    }

    async function loadGuide() {
      try {
        const res = await fetch('/api/v1/docs/guia-frontend', { cache: 'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const mdText = await res.text();
        const html = md.render(mdText);
        const root = document.getElementById('md-root');
        root.innerHTML = html;
        buildTOC();

        // Reemplazar bloques de c√≥digo triple por <pre code> con bot√≥n copiar
        document.querySelectorAll('#md-root pre code').forEach(code => {
          const pre = code.closest('pre');
          pre.classList.add('codeblock');
          const btn = document.createElement('button');
          btn.className = 'copy-btn';
          btn.textContent = 'Copiar';
          btn.addEventListener('click', async () => {
            try { await navigator.clipboard.writeText(code.innerText); btn.textContent = 'Copiado'; setTimeout(()=>btn.textContent='Copiar', 1200); }
            catch (e) { btn.textContent = 'Error'; setTimeout(()=>btn.textContent='Copiar', 1200); }
          });
          pre.appendChild(btn);
        });
      } catch (err) {
        document.getElementById('md-root').textContent = 'Error cargando la gu√≠a: ' + err.message;
      }
    }

    document.getElementById('search').addEventListener('input', (e) => {
      highlightQuery(e.target.value.trim());
    });

    loadGuide();
  </script>
</body>
</html>